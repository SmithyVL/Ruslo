databaseChangeLog:
  - changeSet:
      id: init_tables_0
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: channel
      author: Владислав Кузнецов
      comment: Инициализация таблицы с каналами
      changes:
        - createTable:
            tableName: channel
            remarks: Каналы
            columns:
              - column:
                  name: id
                  type: bigserial
                  remarks: Идентификатор
                  constraints:
                    primaryKey: true
                    primaryKeyName: channel_id_pkey
              - column:
                  name: type
                  type: text
                  remarks: Тип
                  defaultValue: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: name
                  type: text
                  remarks: Название канала
              - column:
                  name: server_id
                  type: bigint
                  remarks: Идентификатор сервера
              - column:
                  name: parent_id
                  type: bigint
                  remarks: Идентификатор родительского канала
              - column:
                  name: position
                  type: bigint
                  remarks: Порядковый номер канала на сервере
  - changeSet:
      id: init_tables_1
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: message
      author: Владислав Кузнецов
      comment: Инициализация таблицы с сообщениями каналов
      changes:
        - createTable:
            tableName: message
            remarks: Сообщения каналов
            columns:
              - column:
                  name: id
                  type: bigserial
                  remarks: Идентификатор
                  constraints:
                    primaryKey: true
                    primaryKeyName: message_id_pkey
              - column:
                  name: author_id
                  type: bigint
                  remarks: Идентификатор пользователя-автора сообщения
                  constraints:
                    nullable: false
              - column:
                  name: channel_id
                  type: bigint
                  remarks: Идентификатор канала
                  constraints:
                    nullable: false
              - column:
                  name: content
                  type: text
                  remarks: Содержимое
                  constraints:
                    nullable: false
              - column:
                  name: position
                  type: bigint
                  remarks: Порядковый номер роли в канале
                  defaultValueNumeric: "0"
                  constraints:
                    nullable: false
              - column:
                  name: type
                  type: text
                  remarks: Тип
                  defaultValue: DEFAULT
                  constraints:
                    nullable: false
              - column:
                  name: created_date
                  type: timestamptz
                  remarks: Дата создания
                  defaultValueDate: now()
                  constraints:
                    nullable: false
              - column:
                  name: updated_date
                  type: timestamptz
                  remarks: Дата обновления
        - addForeignKeyConstraint:
            onDelete: cascade
            onUpdate: restrict
            baseColumnNames: channel_id
            baseTableName: message
            constraintName: fk_channel_message
            referencedColumnNames: id
            referencedTableName: channel